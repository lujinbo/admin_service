webpackJsonp([9],{Aa9B:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=[{title:"管理员ID",dataIndex:"id"},{title:"管理员账号",dataIndex:"user_name"},{title:"管理员邮箱",dataIndex:"user_mail"},{title:"管理员组别",dataIndex:"user_group"},{title:"管理员状态",dataIndex:"status"},{title:"创建时间",dataIndex:"create_time"},{title:"操作",key:"action",scopedSlots:{customRender:"action"}}],i={data:function(){return{columns:s,loading:!1,data:[],pagination:{pageSize:10},alter:{message:"数据加载中!",type:"info"},visible:!1,user_name:"",user_mail:"",user_group:"1",select_visible:!1,game_list:[],select_user_name:"",game_id:"下拉选择要编辑的管理员权限所属项目...",keyword:""}},computed:{table_data:function(){var t=this;return""==this.keyword?this.data:this.data.filter(function(e){return-1!=e.user_name.indexOf(t.keyword)||-1!=e.user_mail.indexOf(t.keyword)})}},methods:{showModal:function(){this.visible=!0},fetch:function(){var t=this;this.$http.get("index.php?a=Admin&m=getAdminList").then(function(e){t.loading=!1,200==e.data.status?(t.data=e.data.data,t.alter={message:"加载成功!",type:"success"}):t.alter={message:e.data.msg,type:"error"}})},handleOk:function(){var t=this;if(!/^[a-zA-Z0-9_-]{3,16}$/.test(this.user_name))return this.$error({title:"非法的用户名",content:"必须是3到16位（字母，数字，下划线，减号）..."}),!1;if(!/^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/.test(this.user_mail))return this.$error({title:"非法的邮件格式",content:"请输入正确的邮箱后重试..."}),!1;this.visible=!1,this.$message.loading("添加中...",0);var e={user_name:this.user_name,user_mail:this.user_mail,user_group:this.user_group};this.$http.post("index.php?a=Admin&m=addAdmin",e).then(function(e){t.$message.destroy(),e.data.send_mail,200==e.data.status&&1==e.data.send_mail&&t.$success({title:"添加管理员成功!",content:"密码是:"+e.data.pwd+",已发送至:"+t.user_mail}),200==e.data.status&&0==e.data.send_mail&&t.$warning({title:"添加管理员成功!",content:"密码是:"+e.data.pwd+",通知邮件发送失败!"}),200!=e.data.status&&t.$error({title:"添加管理员失败!",content:"原因是:"+e.data.msg}),t.fetch()})},handleCancel:function(){this.visible=!1,this.$message.destroy()},handleDefaultMail:function(){""==this.user_mail&&(this.user_mail=this.user_name+"@mytopfun.com")},delAdmin:function(t){var e=this,a={user_name:t};this.$confirm({title:"确认删除管理员:"+t+"吗?",content:"删除后不可恢复，请谨慎操作!",okText:"确认删除",okType:"danger",cancelText:"取消",onOk:function(){e.$http.post("index.php?a=Admin&m=delAdmin",a).then(function(a){e.$message.destroy(),200==a.data.status?(e.data.forEach(function(a,s){a.user_name==t&&e.data.splice(s,1)}),e.$message.success("删除管理员成功!",2)):e.$message.error("删除管理员失败!",2)})}})},getGameList:function(){var t=this;this.$http.get("index.php?a=Api&m=getGameList").then(function(e){t.loading=!1,200==e.data.status?(t.game_list=e.data.data,t.alter={message:"加载成功!",type:"success"}):t.alter={message:e.data.msg,type:"error"}})},editPermission:function(t){this.select_user_name=t,this.select_visible=!0},handleSelect:function(){if(""==this.select_user_name)return this.$error({title:"非法用户名",content:"请先选择要编辑的管理员..."}),!1;this.$router.push("/admin/adminApi/"+this.select_user_name+"/"+this.game_id)},getLoginRecord:function(t){this.$router.push("/admin/loginRecord/"+t)},getRequestRecord:function(t){this.$router.push("/admin/requestRecord/"+t)}},mounted:function(){this.fetch(),this.getGameList()}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"com-item"},[a("a-input-search",{staticStyle:{width:"200px"},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}}),t._v(" "),a("a-button",{attrs:{type:"primary"},on:{click:t.showModal}},[a("a-icon",{attrs:{type:"plus"}}),t._v("添加管理员")],1),t._v(" "),a("a-alert",{staticStyle:{margin:"12px 0"},attrs:{message:t.alter.message,type:t.alter.type,showIcon:"",closable:""}}),t._v(" "),a("a-table",{attrs:{columns:t.columns,dataSource:t.table_data,pagination:t.pagination,loading:t.loading},scopedSlots:t._u([{key:"action",fn:function(e,s){return a("span",{},[a("a-button",{attrs:{type:"dashed"},on:{click:function(e){t.editPermission(s.user_name)}}},[t._v("编辑权限")]),t._v(" "),a("a-button",{on:{click:function(e){t.getLoginRecord(s.user_name)}}},[t._v("登录记录")]),t._v(" "),a("a-button",{on:{click:function(e){t.getRequestRecord(s.user_name)}}},[t._v("请求记录")]),t._v(" "),a("a-button",{attrs:{type:"danger"},on:{click:function(e){t.delAdmin(s.user_name)}}},[t._v("删除")])],1)}}])}),t._v(" "),a("a-modal",{attrs:{title:"添加管理员"},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[a("a-alert",{staticStyle:{"margin-bottom":"12px"},attrs:{message:"默认密码为topfun,登陆后请及时修改密码",banner:""}}),t._v(" "),a("a-form",[a("a-form-item",{staticStyle:{"margin-bottom":"12px"}},[a("a-input",{attrs:{placeholder:"请输入管理员名称"},on:{blur:t.handleDefaultMail},model:{value:t.user_name,callback:function(e){t.user_name=e},expression:"user_name"}},[a("a-icon",{attrs:{slot:"prefix",type:"user"},slot:"prefix"})],1)],1),t._v(" "),a("a-form-item",{staticStyle:{"margin-bottom":"12px"}},[a("a-input",{attrs:{placeholder:"请输入管理员邮箱"},model:{value:t.user_mail,callback:function(e){t.user_mail=e},expression:"user_mail"}},[a("a-icon",{attrs:{slot:"prefix",type:"mail"},slot:"prefix"})],1)],1),t._v(" "),a("a-form-item",{staticStyle:{"margin-bottom":"12px"}},[a("a-select",{attrs:{placeholder:"选择管理员群组"},model:{value:t.user_group,callback:function(e){t.user_group=e},expression:"user_group"}},[a("a-select-option",{attrs:{value:"0"}},[t._v("超级管理员")]),t._v(" "),a("a-select-option",{attrs:{value:"1"}},[t._v("普通管理员")])],1)],1)],1),t._v(" "),a("template",{slot:"footer"},[a("a-button",{on:{click:t.handleCancel}},[t._v("取消")]),t._v(" "),a("a-button",{attrs:{type:"primary"},on:{click:t.handleOk}},[t._v("确认添加")])],1)],2),t._v(" "),a("a-modal",{attrs:{title:"请先选择项目......"},on:{ok:t.handleSelect},model:{value:t.select_visible,callback:function(e){t.select_visible=e},expression:"select_visible"}},[a("a-select",{staticStyle:{width:"100%"},model:{value:t.game_id,callback:function(e){t.game_id=e},expression:"game_id"}},t._l(t.game_list,function(e,s){return a("a-select-option",{key:s,attrs:{value:e.id}},[t._v(t._s(e.name))])}))],1)],1)},staticRenderFns:[]},r=a("VU/8")(i,n,!1,null,null,null);e.default=r.exports}});